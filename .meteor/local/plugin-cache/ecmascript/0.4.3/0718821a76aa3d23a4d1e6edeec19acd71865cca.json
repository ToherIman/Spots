{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/client/map.js","filenameRelative":"/client/map.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/client/map.js.map","sourceFileName":"/client/map.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"map"},"ignored":false,"code":"var MAP_ZOOM = 15;\n\nMeteor.startup(function () {\n  GoogleMaps.load();\n});\n\nTemplate.map.onCreated(function () {\n  var self = this;\n\n  GoogleMaps.ready('map', function (map) {\n    var marker = void 0;\n\n    self.autorun(function () {\n      var latLng = Geolocation.latLng();\n      //Write user position to db\n      console.log(latLng);\n      var userId = Meteor.userId();\n      var userPosition = Position.findOne({ user: userId });\n\n      if (!userPosition && Meteor.userId()) {\n        Position.insert({\n          user: Meteor.userId(),\n          latLng: latLng\n        });\n      } else {\n        Position.update({ _id: userPosition._id }, { $set: { latLng: latLng } });\n      }\n      console.log(userPosition.latLng);\n      //Finished writing user position to db\n      if (!latLng) return;\n\n      if (!marker) {\n        marker = new google.maps.Marker({\n          position: new google.maps.LatLng(latLng.lat, latLng.lng),\n          map: map.instance\n        });\n      } else {\n        marker.setPosition(latLng);\n      }\n      map.instance.setCenter(marker.getPosition());\n      map.instance.setZoom(MAP_ZOOM);\n    });\n\n    //Add custom markers on map\n    google.maps.event.addListener(map.instance, 'click', function (event) {\n      Spots.insert({ lat: event.latLng.lat(), lng: event.latLng.lng(), user: Meteor.userId() });\n      console.log(Spots.find().fetch());\n    });\n\n    var markers = {};\n\n    Spots.find().observe({\n      added: function () {\n        function added(document) {\n          var marker = new google.maps.Marker({\n            draggable: true,\n            animation: google.maps.Animation.DROP,\n            position: new google.maps.LatLng(document.lat, document.lng),\n            icon: '/public/h.pgn',\n            map: map.instance,\n            id: document._id\n          });\n\n          google.maps.event.addListener(marker, 'dragend', function (event) {\n            Spots.update(marker.id, { $set: { lat: event.latLng.lat(), lng: event.latLng.lng() } });\n          });\n\n          google.maps.event.addListener(marker, 'click', function (event) {\n            var selectedMarker = marker.id;\n            Session.set('place', marker.id);\n            console.log(selectedMarker);\n          });\n          markers[document._id] = marker;\n        }\n\n        return added;\n      }(),\n\n      changed: function () {\n        function changed(newDocument, oldDocument) {\n          markers[newDocument._id].setPosition({ lat: newDocument.lat, lng: newDocument.lng });\n        }\n\n        return changed;\n      }(),\n      removed: function () {\n        function removed(oldDocument) {\n          markers[oldDocument._id].setMap(null);\n          google.maps.event.clearInstanceListeners(markers[oldDocument._id]);\n          delete markers[oldDocument._id];\n        }\n\n        return removed;\n      }()\n    });\n  });\n});\n\nTemplate.map.helpers({\n  geolocationError: function () {\n    function geolocationError() {\n      var error = Geolocation.error();\n      return error && error.message;\n    }\n\n    return geolocationError;\n  }(),\n  mapOptions: function () {\n    function mapOptions() {\n      var latLng = Geolocation.latLng();\n      if (GoogleMaps.loaded() && latLng) {\n        return {\n          center: new google.maps.LatLng(latLng.lat, latLng.lng),\n          zoom: MAP_ZOOM\n        };\n      }\n    }\n\n    return mapOptions;\n  }()\n});","ast":null,"map":{"version":3,"sources":["/client/map.js"],"names":[],"mappings":"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","file":"/client/map.js.map","sourcesContent":["let MAP_ZOOM = 15;\n\nMeteor.startup(function() {\n  GoogleMaps.load();\n});\n\nTemplate.map.onCreated(function() {\n  let self = this;\n\n  GoogleMaps.ready('map', function(map) {\n    let marker;\n\n    self.autorun(function () {\n      let latLng = Geolocation.latLng();\n      //Write user position to db\n      console.log(latLng);\n      const userId = Meteor.userId();\n      const userPosition = Position.findOne({user: userId});\n\n      if(!userPosition && Meteor.userId()) {\n        Position.insert({\n            user: Meteor.userId(),\n            latLng: latLng\n        });\n      }\n      else {\n        Position.update({_id: userPosition._id}, { $set: {latLng: latLng}});\n      }\n      console.log(userPosition.latLng);\n      //Finished writing user position to db\n      if(! latLng)\n      return;\n\n      if(!marker) {\n        marker = new google.maps.Marker({\n          position: new google.maps.LatLng(latLng.lat, latLng.lng),\n          map: map.instance\n        });\n      }\n\n      else {\n        marker.setPosition(latLng);\n      }\n      map.instance.setCenter(marker.getPosition());\n      map.instance.setZoom(MAP_ZOOM);\n\n\n    });\n\n    //Add custom markers on map\n    google.maps.event.addListener(map.instance, 'click', function(event) {\n      Spots.insert({ lat: event.latLng.lat(), lng: event.latLng.lng(), user: Meteor.userId() });\n      console.log(Spots.find().fetch());\n    });\n\n     var markers = {};\n\n    Spots.find().observe({\n      added (document) {\n        let marker = new google.maps.Marker({\n          draggable: true,\n          animation: google.maps.Animation.DROP,\n          position: new google.maps.LatLng(document.lat, document.lng),\n          icon: '/public/h.pgn',\n          map: map.instance,\n          id: document._id\n        });\n\n        google.maps.event.addListener(marker, 'dragend', function(event) {\n          Spots.update(marker.id, {$set: {lat: event.latLng.lat(), lng: event.latLng.lng()}});\n        });\n\n        google.maps.event.addListener(marker, 'click', function(event) {\n          let selectedMarker = marker.id;\n          Session.set('place', marker.id);\n          console.log(selectedMarker);\n        });\n        markers[document._id] = marker;\n      },\n      changed: function (newDocument, oldDocument) {\n        markers[newDocument._id].setPosition({lat: newDocument.lat, lng: newDocument.lng});\n      },\n      removed: function (oldDocument) {\n        markers[oldDocument._id].setMap(null);\n        google.maps.event.clearInstanceListeners(markers[oldDocument._id]);\n        delete markers[oldDocument._id];\n      }\n    });\n\n\n  });\n});\n\nTemplate.map.helpers({\n  geolocationError: function () {\n    var error = Geolocation.error();\n    return error && error.message;\n  },\n  mapOptions: function () {\n    var latLng = Geolocation.latLng();\n    if(GoogleMaps.loaded() && latLng) {\n      return {\n        center: new google.maps.LatLng(latLng.lat, latLng.lng),\n        zoom: MAP_ZOOM\n      };\n    }\n  }\n});\n"]},"hash":"0718821a76aa3d23a4d1e6edeec19acd71865cca"}
